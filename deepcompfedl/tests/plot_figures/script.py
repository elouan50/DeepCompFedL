import numpy as np
import plotly.graph_objects as go
import pandas as pd

n=4

sizes = [
    [724, 654, 583, 511, 445, 374, 289, 208, 119, 73],
    [614, 569, 504, 442, 390, 322, 252, 180, 102, 61],
    [526, 480, 428, 374, 331, 273, 217, 155, 88, 53],
    [423, 389, 355, 309, 274, 235, 184, 137, 76, 47],
    [329, 310, 271, 254, 233, 201, 157, 113, 67, 42],
    [293, 285, 256, 237, 217, 181, 148, 109, 64, 39],
    [270, 253, 234, 215, 195, 172, 139, 104, 59, 35]
    ]

accuracies = [
              [
    [0.80582, 0.80259, 0.79849, 0.79989, 0.80095, 0.79865, 0.78583, 0.77907, 0.73902, 0.70334],
    [0.81115, 0.80262, 0.80318, 0.79952, 0.78999, 0.79879, 0.79759, 0.77933, 0.73852, 0.70934],
    [0.80575, 0.79809, 0.80308, 0.79922, 0.80172, 0.79482, 0.79136, 0.77174, 0.72786, 0.69455],
    [0.79172, 0.79246, 0.79103, 0.78883, 0.78523, 0.75528, 0.75698, 0.74795, 0.69575, 0.66850],
    [0.70761, 0.69672, 0.70205, 0.70271, 0.69515, 0.68342, 0.67843, 0.66513, 0.64338, 0.61556],
    [0.61433, 0.62922, 0.61500, 0.62902, 0.64088, 0.60327, 0.60710, 0.60947, 0.57732, 0.55194],
    [0.54567, 0.54108, 0.56689, 0.54984, 0.53838, 0.54977, 0.52868, 0.52099, 0.51446, 0.47298]
    ],
              [
    [0.88515, 0.88755, 0.88481, 0.88732, 0.88585, 0.88383, 0.88498, 0.88432, 0.88072, 0.88031], 
    [0.88926, 0.88877, 0.88675, 0.88746, 0.88731, 0.88745, 0.88395, 0.88520, 0.88246, 0.88059], 
    [0.88675, 0.88666, 0.88887, 0.88604, 0.88641, 0.88666, 0.88598, 0.88364, 0.88244, 0.87825], 
    [0.88735, 0.88627, 0.88560, 0.88649, 0.88674, 0.88421, 0.88472, 0.88294, 0.88125, 0.87738], 
    [0.88396, 0.88309, 0.88478, 0.88389, 0.88449, 0.88382, 0.88368, 0.88020, 0.87881, 0.87449], 
    [0.88083, 0.88091, 0.88183, 0.88150, 0.88089, 0.88116, 0.87823, 0.87850, 0.87538, 0.86956],
    [0.87203, 0.87328, 0.87333, 0.87359, 0.87251, 0.87270, 0.87198, 0.87040, 0.86677, 0.86026]
    ],
              [
    [0.73649, 0.74970, 0.74532, 0.74963, 0.71950, 0.70626, 0.67493, 0.65518, 0.59349, 0.54308], 
    [0.73198, 0.73380, 0.72295, 0.70596, 0.69013, 0.66580, 0.63730, 0.59090, 0.55738, 0.50232], 
    [0.59422, 0.59847, 0.57036, 0.53023, 0.57182, 0.53378, 0.51440, 0.50481, 0.44113, 0.43522], 
    [0.45354, 0.45789, 0.44949, 0.43625, 0.42506, 0.43804, 0.42058, 0.40342, 0.36227, 0.35524], 
    [0.38391, 0.39045, 0.39539, 0.38112, 0.36546, 0.37804, 0.36708, 0.34292, 0.33951, 0.31790], 
    [0.35208, 0.35968, 0.34419, 0.34535, 0.34226, 0.32623, 0.31890, 0.29825, 0.28130, 0.25561], 
    [0.29411, 0.28959, 0.27340, 0.26394, 0.27911, 0.26895, 0.24668, 0.23384, 0.20360, 0.19995], 
    ],
              [
    [0.85516, 0.85835, 0.86027, 0.85423, 0.85570, 0.85281, 0.84976, 0.84844, 0.83835, 0.82604],
    [0.85830, 0.85642, 0.85639, 0.85564, 0.85759, 0.84921, 0.85016, 0.85055, 0.83840, 0.82817],
    [0.85954, 0.85899, 0.85711, 0.85798, 0.85362, 0.85301, 0.85020, 0.84536, 0.83640, 0.82716],
    [0.85461, 0.85449, 0.84848, 0.84624, 0.85110, 0.84721, 0.84730, 0.84205, 0.83742, 0.82521],
    [0.83788, 0.84202, 0.84078, 0.84010, 0.83827, 0.83666, 0.83733, 0.83154, 0.82280, 0.81436],
    [0.83388, 0.82730, 0.82992, 0.82873, 0.82865, 0.82737, 0.82741, 0.82243, 0.80983, 0.79776],
    [0.80002, 0.80663, 0.80267, 0.80253, 0.80853, 0.80252, 0.79637, 0.79326, 0.78834, 0.76808]
    ]
]

surface = pd.DataFrame(sizes, #accuracies[n-1],
                       index=[2**i for i in range(8,1,-1)],
                       columns=[.1,.2,.3,.4,.5,.6,.7,.8,.9,.95])

fig = go.Figure(data=[go.Surface(x=surface.columns,
                                 y=np.log2(surface.index),
                                 z=surface.values,
                                 colorscale='Viridis',
                                 lighting=dict(
                                     ambient=0.8,
                                     diffuse=0.5,
                                     specular=0.2,
                                     roughness=0.9,
                                     fresnel=0.1
                                 ),
                                 lightposition=dict(x=100, y=200, z=0),  # Light from a better angle
                                 contours={
                                     "x": {"show": True, "start": 0, "end": 1, "size": 0.1},
                                     "y": {"show": True, "start": 0, "end": 8, "size": 1},
                                     "z": {"show": True, "start": 0, "end": 700, "size": 50}
                                 }
                                 )])

dtick_for_scenario = {1: 0.05, 2: 0.005, 3: 0.1, 4: 0.01}

fig.update_layout(
    scene=dict(
        xaxis_title=dict(text='Pruning rate', font=dict(size=23)),
        yaxis_title=dict(text='Quantization clusters', font=dict(size=23)),
        zaxis_title=dict(text='Size (in kB)', font=dict(size=23)),
        xaxis=dict(
            tickmode='array',
            tickvals=surface.columns,
            ticktext=[str(i) for i in surface.columns],
            tickfont=dict(size=16),
            minallowed=0.1, maxallowed=0.95
        ),
        yaxis=dict(
            tickmode='array',
            tickvals=np.log2(surface.index),
            ticktext=[str(i) for i in surface.index],
            tickfont=dict(size=16),
            minallowed=2, maxallowed=8
        ),
        zaxis=dict(
            #dtick=dtick_for_scenario[n],
            tickfont=dict(size=16),
        )
    ),
    margin=dict(l=0, r=0, t=0, b=100)
)

fig.update_traces(contours_z=dict(show=True,
                                  usecolormap=True,
                                  project_z=False))

fig.show()
